# sds-child-theme-fixes

# LOG:

## Version 3.10

**Виправлено втрату контенту при імпорті HTML з Tailwind CSS класами**

### Зміни:
- **Додано агресивне видалення проблемних CSS класів** з селекторами "]:" які псували відображення
- **Створено маппінг Tailwind класів** на WordPress семантичні класи
- **Додано розумну очистку CSS** з збереженням тільки корисних класів
- **Покращено послідовність обробки HTML** - атрибути → CSS → структура → медіа → очистка
- **Додано додаткову очистку регулярними виразами** для видалення порожніх тегів
- **Розширено логування** для відстеження процесу очищення HTML

### Результат:
Тепер складний HTML з Tailwind CSS (таблиці, блоки, списки) коректно імпортується та відображається у WordPress замість порожнього контенту

## Version 3.9

## Опис змін для коміту

**Виправлено втрату зворотних слешів у блоках коду при імпорті через WP All Import**

### Зміни:
- **Додано захист зворотних слешів** в блоках `<pre>` та `<code>` через унікальний маркер
- **Видалено проблемні функції** `htmlspecialchars_decode()` та `htmlentities()` які псували слеші
- **Додано виключення для блоків коду** в функціях `remove_attributes()`, `merge_nested_elements()`, `removeEmptyNodes()`
- **Використано `wp_slash()`** для захисту від WordPress `stripslashes_deep()`
- **Додано заміну повноширинних слешів** "＼" на звичайні "\"
- **Покращено LIBXML опції** для кращого збереження структури HTML

### Результат:
Тепер `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows` коректно зберігається при імпорті замість `HKEY_LOCAL_MACHINESOFTWAREMicrosoftWindows`

## 3.7

### Завантажив шаблони імпортів у _WP_ALL_IMPORT_TEMPLATES


### Галерея WordPress з розширеною навігацією

Додано */_elementtor_css_for_old_posts/js+css-elementor_for_old_galleries.md
Цей JavaScript скрипт додає зручну та стабільну навігацію для стандартних галерей WordPress з додатковими функціями.

#### Функціональність

- Заміняє стандартну галерею WordPress власною реалізацією з сіткою 4×4
- Додає власний лайтбокс з надійною навігацією між зображеннями
- Автоматично включає обкладинку запису (головне зображення) до галереї
- Дозволяє запускати галерею як з мініатюр, так і з головного зображення
- Забезпечує адаптивний дизайн для всіх типів пристроїв

#### Особливості

- Зручна навігація стрілками та клавішами клавіатури
- Плавні анімації переходів між зображеннями
- Лічильник зображень (наприклад, "2 / 4")
- Ефекти при наведенні на мініатюри
- Відображає галерею в 4 колонки на десктопі, 2 на планшетах, 1 на мобільних

#### Встановлення

1. Додайте цей код до вашого WordPress сайту через:
- Плагін Custom CSS & JS
- Файл functions.php вашої теми
- Секцію "Додатковий JavaScript" у вашій темі

## Version 3.6

### Покращення функції обробки імпортованих статей у */SDStudio-WP_All_Import-Fixes.php

### Основні зміни та покращення

Ми вдосконалили дві функції, які обробляють HTML контент імпортованих статей та керують зображеннями:

#### 1. Функція `sdstudio_clean_html()`

##### ** Використання у шаблоні WP All Import:**

`[sdstudio_clean_html({content[1]})]`

Модифікації в цій функції дозволяють правильно обробляти зображення в різних контекстах:

- Додано підтримку для отримання повнорозмірних зображень з лайтбоксів (коли зображення загорнуте в посилання з `rel="lightbox"`)
- Додано можливість отримання оригінальних зображень з посилань, що ведуть безпосередньо на файли зображень
- Реалізовано очищення URL від параметрів після знаку питання `?` для уникнення дублювання зображень
- Покращено обробку різних типів HTML структур, які можуть містити зображення

Функція тепер коректно збирає всі зображення зі статті та створює галерею у форматі шорткоду, що містить усі зображення.

### 2. Функція `add_image_in_post_Import()`

Ця функція була оптимізована для роботи з зображеннями після імпорту статті:

- Забезпечує прикріплення всіх зображень до поста (встановлює post_parent)
- Перевіряє, чи вже має пост обкладинку (featured image)
- Якщо обкладинка відсутня, бере перше зображення з галереї та встановлює його як обкладинку
- Модифікує шорткод галереї, видаляючи зображення, яке стало обкладинкою
- Коректно обробляє випадки, коли в галереї не залишається зображень після встановлення обкладинки

## Технічні особливості

1. **Покращено обробку посилань:**
    - Функція перевіряє, чи містить посилання `rel="lightbox"`
    - Перевіряє, чи веде посилання на файл зображення (має розширення .jpg, .png, тощо)
    - Перевіряє, чи містить посилання вкладене зображення `<img>`

2. **Оптимізовано роботу з URL:**
    - Реалізовано очищення URL від параметрів (все після `?`)
    - Доповнюються відносні URL повним доменом для коректного завантаження

3. **Покращено роботу з WordPress:**
    - Використано WordPress API для прикріплення зображень до постів
    - Реалізовано механізм запобігання дублюванню зображень за допомогою метаданих
    - Коректно модифікується шорткод галереї після встановлення обкладинки

## Результат

В результаті цих змін, система тепер:
1. Імпортує та зберігає оригінальні (повнорозмірні) версії зображень
2. Правильно прикріплює зображення до відповідних постів
3. Автоматично встановлює обкладинку з першого зображення (якщо обкладинка відсутня)
4. Формує галерею з решти зображень
5. Підтримує різні формати HTML та типи структур, що містять зображення

Ці покращення забезпечують більш якісний імпорт контенту з зображеннями та кращу організацію медіа-бібліотеки WordPress.

## Version 3.5

WordPress - Різні фікси для дочірніх тем сайту

### Version 3.5:
Виправоено привязку зображень до постів + повязання між собою перекладів

### Version 3.4:
Відмінено функціонал REST API - Завантажує процесор серверу у потолок

### Version 3.3:
Реалізовано завантаження зображень з повним збереженням структури посилань, з регістром у імені зображень, і з завантаженням згідно старому розміщенню.